{"version":3,"sources":["../src/events.ts","../src/store.ts","../src/math.ts","../src/renderer_webgl.ts","../src/history.ts","../src/editor.ts","../src/plugins_builtin.ts"],"names":[],"mappings":";;;;;AAAO,IAAM,UAAN,MAA6C;AAAA,EAA7C,WAAA,GAAA;AACL,IAAA,aAAA,CAAA,IAAA,EAAQ,WAAA,sBAAgB,GAAA,EAA0C,CAAA;AAAA,EAAA;AAAA,EAElE,EAAA,CAAsB,MAAS,EAAA,EAAyC;AAH1E,IAAA,IAAA,EAAA;AAII,IAAA,MAAM,GAAA,GAAA,CAAM,UAAK,SAAA,CAAU,GAAA,CAAI,IAAI,CAAA,KAAvB,IAAA,GAAA,EAAA,uBAAgC,GAAA,EAAI;AAChD,IAAA,GAAA,CAAI,IAAI,EAAS,CAAA;AACjB,IAAA,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,IAAA,EAAM,GAAG,CAAA;AAC5B,IAAA,OAAO,MAAM,GAAA,CAAI,MAAA,CAAO,EAAS,CAAA;AAAA,EACnC;AAAA,EAEA,IAAA,CAAwB,MAAS,OAAA,EAAe;AAC9C,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,SAAA,CAAU,GAAA,CAAI,IAAI,CAAA;AACnC,IAAA,IAAI,CAAC,GAAA,EAAK;AACV,IAAA,KAAA,MAAW,EAAA,IAAM,GAAA,EAAK,EAAA,CAAG,OAAO,CAAA;AAAA,EAClC;AACF,CAAA;;;ACLO,IAAM,QAAN,MAAY;AAAA,EAIjB,YAAY,OAAA,EAAsB;AAHlC,IAAA,aAAA,CAAA,IAAA,EAAQ,OAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,MAAA,sBAAW,GAAA,EAA8B,CAAA;AAG/C,IAAA,IAAA,CAAK,KAAA,GAAQ,OAAA;AAAA,EACf;AAAA,EAEA,GAAA,GAAmB;AACjB,IAAA,OAAO,IAAA,CAAK,KAAA;AAAA,EACd;AAAA,EAEA,IAAI,IAAA,EAAmB;AACrB,IAAA,IAAA,CAAK,KAAA,GAAQ,IAAA;AACb,IAAA,KAAA,MAAW,EAAA,IAAM,IAAA,CAAK,IAAA,EAAM,EAAA,CAAG,KAAK,KAAK,CAAA;AAAA,EAC3C;AAAA,EAEA,MAAM,EAAA,EAAa;AACjB,IAAA,MAAM,IAAA,GAAO,EAAA,CAAG,IAAA,CAAK,KAAK,CAAA;AAC1B,IAAA,IAAA,CAAK,IAAI,IAAI,CAAA;AAAA,EACf;AAAA,EAEA,UAAU,EAAA,EAA0C;AAClD,IAAA,IAAA,CAAK,IAAA,CAAK,IAAI,EAAE,CAAA;AAChB,IAAA,OAAO,MAAM,IAAA,CAAK,IAAA,CAAK,MAAA,CAAO,EAAE,CAAA;AAAA,EAClC;AACF,CAAA;;;AClCO,SAAS,aAAA,CAAc,CAAA,EAAW,CAAA,EAAW,EAAA,EAAc;AAChE,EAAA,OAAO,EAAE,CAAA,EAAG,CAAA,GAAI,EAAA,CAAG,IAAA,GAAO,EAAA,CAAG,IAAA,EAAM,CAAA,EAAG,CAAA,GAAI,EAAA,CAAG,IAAA,GAAO,EAAA,CAAG,IAAA,EAAK;AAC9D;AAEO,SAAS,aAAA,CAAc,CAAA,EAAW,CAAA,EAAW,EAAA,EAAc;AAChE,EAAA,OAAO,EAAE,CAAA,EAAA,CAAI,CAAA,GAAI,EAAA,CAAG,IAAA,IAAQ,EAAA,CAAG,IAAA,EAAM,CAAA,EAAA,CAAI,CAAA,GAAI,EAAA,CAAG,IAAA,IAAQ,EAAA,CAAG,IAAA,EAAK;AAClE;AAGO,SAAS,OAAA,CAAQ,KAAA,EAAkB,EAAA,EAAY,EAAA,EAA4B;AAChF,EAAA,MAAM,MAAA,GAAS,CAAC,GAAG,KAAK,EACrB,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,EAAE,MAAM,CAAA,CACvB,IAAA,CAAK,CAAC,GAAG,CAAA,KAAG;AAdjB,IAAA,IAAA,EAAA,EAAA,EAAA;AAcqB,IAAA,OAAA,CAAA,CAAA,EAAA,GAAA,CAAA,CAAE,CAAA,KAAF,IAAA,GAAA,EAAA,GAAO,CAAA,KAAA,CAAM,EAAA,GAAA,CAAA,CAAE,MAAF,IAAA,GAAA,EAAA,GAAO,CAAA,CAAA;AAAA,EAAA,CAAE,CAAA;AAEzC,EAAA,KAAA,IAAS,IAAI,MAAA,CAAO,MAAA,GAAS,CAAA,EAAG,CAAA,IAAK,GAAG,CAAA,EAAA,EAAK;AAC3C,IAAA,MAAM,CAAA,GAAI,OAAO,CAAC,CAAA;AAClB,IAAA,IAAI,MAAM,CAAA,CAAE,CAAA,IAAK,EAAA,IAAM,CAAA,CAAE,IAAI,CAAA,CAAE,CAAA,IAAK,EAAA,IAAM,CAAA,CAAE,KAAK,EAAA,IAAM,CAAA,CAAE,CAAA,GAAI,CAAA,CAAE,GAAG,OAAO,CAAA;AAAA,EAC3E;AACA,EAAA,OAAO,IAAA;AACT;AAEO,SAAS,KAAA,CAAM,CAAA,EAAW,GAAA,EAAa,GAAA,EAAa;AACzD,EAAA,OAAO,KAAK,GAAA,CAAI,GAAA,EAAK,KAAK,GAAA,CAAI,GAAA,EAAK,CAAC,CAAC,CAAA;AACvC;;;ACtBA,SAAS,OAAA,CAAQ,EAAA,EAA4B,IAAA,EAAc,GAAA,EAAa;AACtE,EAAA,MAAM,EAAA,GAAK,EAAA,CAAG,YAAA,CAAa,IAAI,CAAA;AAC/B,EAAA,IAAI,CAAC,EAAA,EAAI,MAAM,IAAI,MAAM,qBAAqB,CAAA;AAC9C,EAAA,EAAA,CAAG,YAAA,CAAa,IAAI,GAAG,CAAA;AACvB,EAAA,EAAA,CAAG,cAAc,EAAE,CAAA;AACnB,EAAA,IAAI,CAAC,EAAA,CAAG,kBAAA,CAAmB,EAAA,EAAI,EAAA,CAAG,cAAc,CAAA,EAAG;AACjD,IAAA,MAAM,GAAA,GAAM,EAAA,CAAG,gBAAA,CAAiB,EAAE,CAAA;AAClC,IAAA,EAAA,CAAG,aAAa,EAAE,CAAA;AAClB,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,uBAAA,EAA0B,GAAA,IAAA,IAAA,GAAA,GAAA,GAAO,EAAE,CAAA,CAAE,CAAA;AAAA,EACvD;AACA,EAAA,OAAO,EAAA;AACT;AAEA,SAAS,IAAA,CAAK,EAAA,EAA4B,EAAA,EAAiB,EAAA,EAAiB;AAC1E,EAAA,MAAM,CAAA,GAAI,GAAG,aAAA,EAAc;AAC3B,EAAA,IAAI,CAAC,CAAA,EAAG,MAAM,IAAI,MAAM,sBAAsB,CAAA;AAC9C,EAAA,EAAA,CAAG,YAAA,CAAa,GAAG,EAAE,CAAA;AACrB,EAAA,EAAA,CAAG,YAAA,CAAa,GAAG,EAAE,CAAA;AACrB,EAAA,EAAA,CAAG,YAAY,CAAC,CAAA;AAChB,EAAA,IAAI,CAAC,EAAA,CAAG,mBAAA,CAAoB,CAAA,EAAG,EAAA,CAAG,WAAW,CAAA,EAAG;AAC9C,IAAA,MAAM,GAAA,GAAM,EAAA,CAAG,iBAAA,CAAkB,CAAC,CAAA;AAClC,IAAA,EAAA,CAAG,cAAc,CAAC,CAAA;AAClB,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,qBAAA,EAAwB,GAAA,IAAA,IAAA,GAAA,GAAA,GAAO,EAAE,CAAA,CAAE,CAAA;AAAA,EACrD;AACA,EAAA,OAAO,CAAA;AACT;AAEO,IAAM,gBAAN,MAAoB;AAAA,EAazB,YAAoB,MAAA,EAA2B;AAA3B,IAAA,IAAA,CAAA,MAAA,GAAA,MAAA;AAZpB,IAAA,aAAA,CAAA,IAAA,EAAQ,IAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,SAAA,CAAA;AAER,IAAA,aAAA,CAAA,IAAA,EAAQ,KAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,SAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,aAAA,CAAA;AAER,IAAA,aAAA,CAAA,IAAA,EAAQ,aAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,KAAA,CAAA;AAER,IAAA,aAAA,CAAA,IAAA,EAAQ,UAAA,EAAW,CAAA,CAAA;AAGjB,IAAA,MAAM,EAAA,GAAK,OAAO,UAAA,CAAW,QAAA,EAAU,EAAE,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,KAAA,EAAO,CAAA;AACxE,IAAA,IAAI,CAAC,EAAA,EAAI,MAAM,IAAI,MAAM,sBAAsB,CAAA;AAC/C,IAAA,IAAA,CAAK,EAAA,GAAK,EAAA;AAEV,IAAA,MAAM,EAAA,GAAK,OAAA;AAAA,MACT,EAAA;AAAA,MACA,EAAA,CAAG,aAAA;AAAA,MACH,CAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA;AAAA,KAwBF;AAEA,IAAA,MAAM,EAAA,GAAK,OAAA;AAAA,MACT,EAAA;AAAA,MACA,EAAA,CAAG,eAAA;AAAA,MACH,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA;AAAA,KASF;AAEA,IAAA,IAAA,CAAK,OAAA,GAAU,IAAA,CAAK,EAAA,EAAI,EAAA,EAAI,EAAE,CAAA;AAC9B,IAAA,EAAA,CAAG,aAAa,EAAE,CAAA;AAClB,IAAA,EAAA,CAAG,aAAa,EAAE,CAAA;AAElB,IAAA,MAAM,IAAA,GAAO,EAAA,CAAG,kBAAA,CAAmB,IAAA,CAAK,SAAS,aAAa,CAAA;AAC9D,IAAA,MAAM,GAAA,GAAM,EAAA,CAAG,kBAAA,CAAmB,IAAA,CAAK,SAAS,KAAK,CAAA;AACrD,IAAA,IAAI,CAAC,IAAA,EAAM,MAAM,IAAI,MAAM,uCAAuC,CAAA;AAClE,IAAA,IAAA,CAAK,WAAA,GAAc,IAAA;AACnB,IAAA,IAAA,CAAK,GAAA,GAAM,GAAA;AAEX,IAAA,MAAM,GAAA,GAAM,GAAG,iBAAA,EAAkB;AACjC,IAAA,MAAM,OAAA,GAAU,GAAG,YAAA,EAAa;AAChC,IAAA,MAAM,WAAA,GAAc,GAAG,YAAA,EAAa;AACpC,IAAA,IAAI,CAAC,OAAO,CAAC,OAAA,IAAW,CAAC,WAAA,EAAa,MAAM,IAAI,KAAA,CAAM,0BAA0B,CAAA;AAChF,IAAA,IAAA,CAAK,GAAA,GAAM,GAAA;AACX,IAAA,IAAA,CAAK,OAAA,GAAU,OAAA;AACf,IAAA,IAAA,CAAK,WAAA,GAAc,WAAA;AAEnB,IAAA,EAAA,CAAG,eAAA,CAAgB,KAAK,GAAG,CAAA;AAG3B,IAAA,EAAA,CAAG,UAAA,CAAW,EAAA,CAAG,YAAA,EAAc,IAAA,CAAK,OAAO,CAAA;AAC3C,IAAA,EAAA,CAAG,UAAA;AAAA,MACD,EAAA,CAAG,YAAA;AAAA,MACH,IAAI,YAAA,CAAa;AAAA,QACf,CAAA;AAAA,QAAG,CAAA;AAAA,QACH,CAAA;AAAA,QAAG,CAAA;AAAA,QACH,CAAA;AAAA,QAAG,CAAA;AAAA,QACH,CAAA;AAAA,QAAG,CAAA;AAAA,QACH,CAAA;AAAA,QAAG,CAAA;AAAA,QACH,CAAA;AAAA,QAAG;AAAA,OACJ,CAAA;AAAA,MACD,EAAA,CAAG;AAAA,KACL;AACA,IAAA,EAAA,CAAG,wBAAwB,CAAC,CAAA;AAC5B,IAAA,EAAA,CAAG,oBAAoB,CAAA,EAAG,CAAA,EAAG,GAAG,KAAA,EAAO,KAAA,EAAO,GAAG,CAAC,CAAA;AAGlD,IAAA,EAAA,CAAG,UAAA,CAAW,EAAA,CAAG,YAAA,EAAc,IAAA,CAAK,WAAW,CAAA;AAC/C,IAAA,EAAA,CAAG,UAAA,CAAW,EAAA,CAAG,YAAA,EAAc,CAAA,EAAG,GAAG,YAAY,CAAA;AAEjD,IAAA,MAAM,SAAS,CAAA,GAAI,CAAA;AACnB,IAAA,EAAA,CAAG,wBAAwB,CAAC,CAAA;AAC5B,IAAA,EAAA,CAAG,oBAAoB,CAAA,EAAG,CAAA,EAAG,GAAG,KAAA,EAAO,KAAA,EAAO,QAAQ,CAAC,CAAA;AACvD,IAAA,EAAA,CAAG,mBAAA,CAAoB,GAAG,CAAC,CAAA;AAE3B,IAAA,EAAA,CAAG,wBAAwB,CAAC,CAAA;AAC5B,IAAA,EAAA,CAAG,mBAAA,CAAoB,GAAG,CAAA,EAAG,EAAA,CAAG,OAAO,KAAA,EAAO,MAAA,EAAQ,IAAI,CAAC,CAAA;AAC3D,IAAA,EAAA,CAAG,mBAAA,CAAoB,GAAG,CAAC,CAAA;AAE3B,IAAA,EAAA,CAAG,gBAAgB,IAAI,CAAA;AAAA,EACzB;AAAA,EAEA,mBAAA,CAAoB,GAAA,GAAM,MAAA,CAAO,gBAAA,EAAkB;AACjD,IAAA,MAAM,IAAI,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,MAAA,CAAO,cAAc,GAAG,CAAA;AAClD,IAAA,MAAM,IAAI,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,MAAA,CAAO,eAAe,GAAG,CAAA;AACnD,IAAA,IAAI,KAAK,MAAA,CAAO,KAAA,KAAU,KAAK,IAAA,CAAK,MAAA,CAAO,WAAW,CAAA,EAAG;AACvD,MAAA,IAAA,CAAK,OAAO,KAAA,GAAQ,CAAA;AACpB,MAAA,IAAA,CAAK,OAAO,MAAA,GAAS,CAAA;AAAA,IACvB;AAAA,EACF;AAAA,EAEA,MAAA,CAAO,GAAA,EAAoB,EAAA,EAAc,SAAA,EAAqB;AAC5D,IAAA,MAAM,KAAK,IAAA,CAAK,EAAA;AAChB,IAAA,IAAA,CAAK,mBAAA,EAAoB;AAEzB,IAAA,EAAA,CAAG,QAAA,CAAS,GAAG,CAAA,EAAG,IAAA,CAAK,OAAO,KAAA,EAAO,IAAA,CAAK,OAAO,MAAM,CAAA;AAEvD,IAAA,EAAA,CAAG,UAAA,CAAW,KAAK,OAAO,CAAA;AAC1B,IAAA,EAAA,CAAG,SAAA,CAAU,KAAK,WAAA,EAAa,IAAA,CAAK,OAAO,KAAA,EAAO,IAAA,CAAK,OAAO,MAAM,CAAA;AAEpE,IAAA,MAAM,EAAA,GAAK,IAAI,IAAA,CAAK,UAAA;AACpB,IAAA,IAAI,KAAK,GAAA,EAAK,EAAA,CAAG,SAAA,CAAU,IAAA,CAAK,KAAK,EAAA,CAAG,CAAC,CAAA,EAAG,EAAA,CAAG,CAAC,CAAA,EAAG,EAAA,CAAG,CAAC,CAAA,EAAG,EAAA,CAAG,CAAC,CAAC,CAAA;AAC/D,IAAA,EAAA,CAAG,UAAA,CAAW,EAAA,CAAG,CAAC,CAAA,EAAG,EAAA,CAAG,CAAC,CAAA,EAAG,EAAA,CAAG,CAAC,CAAA,EAAG,EAAA,CAAG,CAAC,CAAC,CAAA;AACxC,IAAA,EAAA,CAAG,KAAA,CAAM,GAAG,gBAAgB,CAAA;AAE5B,IAAA,MAAM,KAAA,GAAQ,IAAI,KAAA,CAAM,MAAA;AAAA,MACtB,CAAC,CAAA,KAAqB,CAAA,CAAE,IAAA,KAAS,MAAA,IAAU,CAAC,CAAA,CAAE;AAAA,KAChD;AAEA,IAAA,MAAM,QAAQ,KAAA,CAAM,MAAA;AACpB,IAAA,MAAM,IAAA,GAAO,IAAI,YAAA,CAAa,KAAA,GAAQ,CAAC,CAAA;AACvC,IAAA,MAAM,YAAA,GAAe,IAAI,GAAA,CAAI,SAAS,CAAA;AAEtC,IAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,KAAA,EAAO,CAAA,EAAA,EAAK;AAC9B,MAAA,MAAM,CAAA,GAAI,MAAM,CAAC,CAAA;AACjB,MAAA,MAAM,IAAI,aAAA,CAAc,CAAA,CAAE,CAAA,EAAG,CAAA,CAAE,GAAG,EAAE,CAAA;AACpC,MAAA,MAAM,CAAA,GAAI,CAAA,CAAE,CAAA,GAAI,EAAA,CAAG,IAAA;AACnB,MAAA,MAAM,CAAA,GAAI,CAAA,CAAE,CAAA,GAAI,EAAA,CAAG,IAAA;AAEnB,MAAA,MAAM,KAAA,GAAQ,YAAA,CAAa,GAAA,CAAI,CAAA,CAAE,EAAE,CAAA;AACnC,MAAA,MAAM,IAAU,CAAA,CAAE,IAAA;AAClB,MAAA,MAAM,CAAA,GAAI,QAAQ,IAAA,GAAO,CAAA;AAEzB,MAAA,MAAM,IAAI,CAAA,GAAI,CAAA;AACd,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,CAAA,CAAE,CAAA;AAChB,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,CAAA,CAAE,CAAA;AAChB,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,CAAA;AACd,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,CAAA;AACd,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,IAAA,CAAK,IAAI,CAAA,EAAG,CAAA,CAAE,CAAC,CAAA,GAAI,CAAC,CAAA;AAClC,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,IAAA,CAAK,IAAI,CAAA,EAAG,CAAA,CAAE,CAAC,CAAA,GAAI,CAAC,CAAA;AAClC,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,IAAA,CAAK,IAAI,CAAA,EAAG,CAAA,CAAE,CAAC,CAAA,GAAI,CAAC,CAAA;AAClC,MAAA,IAAA,CAAK,CAAA,GAAI,CAAC,CAAA,GAAI,CAAA,CAAE,CAAC,CAAA;AAAA,IACnB;AAEA,IAAA,EAAA,CAAG,eAAA,CAAgB,KAAK,GAAG,CAAA;AAC3B,IAAA,EAAA,CAAG,UAAA,CAAW,EAAA,CAAG,YAAA,EAAc,IAAA,CAAK,WAAW,CAAA;AAE/C,IAAA,IAAI,KAAA,GAAQ,KAAK,QAAA,EAAU;AACzB,MAAA,IAAA,CAAK,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,KAAA,EAAO,IAAA,CAAK,MAAM,IAAA,CAAK,QAAA,GAAW,GAAG,CAAA,GAAI,EAAE,CAAA;AACpE,MAAA,EAAA,CAAG,UAAA,CAAW,GAAG,YAAA,EAAc,IAAA,CAAK,WAAW,CAAA,GAAI,CAAA,EAAG,GAAG,YAAY,CAAA;AAAA,IACvE;AACA,IAAA,EAAA,CAAG,aAAA,CAAc,EAAA,CAAG,YAAA,EAAc,CAAA,EAAG,IAAI,CAAA;AAEzC,IAAA,EAAA,CAAG,mBAAA,CAAoB,EAAA,CAAG,SAAA,EAAW,CAAA,EAAG,GAAG,KAAK,CAAA;AAEhD,IAAA,EAAA,CAAG,gBAAgB,IAAI,CAAA;AAAA,EACzB;AAAA,EAEA,OAAA,GAAU;AACR,IAAA,MAAM,KAAK,IAAA,CAAK,EAAA;AAChB,IAAA,EAAA,CAAG,YAAA,CAAa,KAAK,OAAO,CAAA;AAC5B,IAAA,EAAA,CAAG,YAAA,CAAa,KAAK,WAAW,CAAA;AAChC,IAAA,EAAA,CAAG,iBAAA,CAAkB,KAAK,GAAG,CAAA;AAC7B,IAAA,EAAA,CAAG,aAAA,CAAc,KAAK,OAAO,CAAA;AAAA,EAC/B;AACF,CAAA;;;ACjNO,IAAM,UAAN,MAAc;AAAA,EAAd,WAAA,GAAA;AACL,IAAA,aAAA,CAAA,IAAA,EAAQ,aAAuB,EAAC,CAAA;AAChC,IAAA,aAAA,CAAA,IAAA,EAAQ,aAAuB,EAAC,CAAA;AAAA,EAAA;AAAA,EAEhC,KAAK,GAAA,EAAc;AACjB,IAAA,IAAA,CAAK,SAAA,CAAU,KAAK,GAAG,CAAA;AACvB,IAAA,IAAA,CAAK,YAAY,EAAC;AAAA,EACpB;AAAA,EAEA,OAAA,GAAU;AACR,IAAA,OAAO,IAAA,CAAK,UAAU,MAAA,GAAS,CAAA;AAAA,EACjC;AAAA,EAEA,OAAA,GAAU;AACR,IAAA,OAAO,IAAA,CAAK,UAAU,MAAA,GAAS,CAAA;AAAA,EACjC;AAAA,EAEA,KAAK,GAAA,EAA2D;AAC9D,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,SAAA,CAAU,GAAA,EAAI;AAC/B,IAAA,IAAI,CAAC,GAAA,EAAK,OAAO,EAAE,GAAA,EAAI;AACvB,IAAA,MAAM,IAAA,GAAO,GAAA,CAAI,IAAA,CAAK,GAAG,CAAA;AACzB,IAAA,IAAA,CAAK,SAAA,CAAU,KAAK,GAAG,CAAA;AACvB,IAAA,OAAO,EAAE,GAAA,EAAK,IAAA,EAAM,IAAA,EAAM,IAAI,IAAA,EAAK;AAAA,EACrC;AAAA,EAEA,KAAK,GAAA,EAA2D;AAC9D,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,SAAA,CAAU,GAAA,EAAI;AAC/B,IAAA,IAAI,CAAC,GAAA,EAAK,OAAO,EAAE,GAAA,EAAI;AACvB,IAAA,MAAM,IAAA,GAAO,GAAA,CAAI,EAAA,CAAG,GAAG,CAAA;AACvB,IAAA,IAAA,CAAK,SAAA,CAAU,KAAK,GAAG,CAAA;AACvB,IAAA,OAAO,EAAE,GAAA,EAAK,IAAA,EAAM,IAAA,EAAM,IAAI,IAAA,EAAK;AAAA,EACrC;AAAA,EAEA,KAAA,GAAQ;AACN,IAAA,IAAA,CAAK,YAAY,EAAC;AAClB,IAAA,IAAA,CAAK,YAAY,EAAC;AAAA,EACpB;AACF,CAAA;;;ACrCA,SAAS,UAAA,GAA4B;AACnC,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,EAAE,KAAA,EAAO,IAAA,EAAM,MAAA,EAAQ,GAAA,EAAK,UAAA,EAAY,CAAC,GAAA,EAAK,GAAA,EAAK,IAAA,EAAM,CAAC,CAAA,EAAE;AAAA,IAClE,OAAO;AAAC,GACV;AACF;AAEA,SAAS,eAAA,GAA4B;AACnC,EAAA,OAAO,EAAE,IAAA,EAAM,CAAA,EAAG,IAAA,EAAM,CAAA,EAAG,MAAM,CAAA,EAAE;AACrC;AAEA,SAAS,UAAa,CAAA,EAAS;AAC7B,EAAA,OAAO,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,SAAA,CAAU,CAAC,CAAC,CAAA;AACrC;AAEO,IAAM,eAAN,MAAmB;AAAA,EAcxB,YAAY,IAAA,EAA+D;AAb3E,IAAA,aAAA,CAAA,IAAA,EAAQ,SAAA,EAAU,IAAI,OAAA,EAAwB,CAAA;AAC9C,IAAA,aAAA,CAAA,IAAA,EAAQ,OAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,UAAA,CAAA;AAER,IAAA,aAAA,CAAA,IAAA,EAAQ,WAA0B,EAAC,CAAA;AACnC,IAAA,aAAA,CAAA,IAAA,EAAQ,SAAA,EAAU,IAAI,OAAA,EAAQ,CAAA;AAE9B,IAAA,aAAA,CAAA,IAAA,EAAQ,aAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,UAAA,EAAW,KAAA,CAAA;AACnB,IAAA,aAAA,CAAA,IAAA,EAAQ,YAAA,EAAqB,MAAA,CAAA;AAC7B,IAAA,aAAA,CAAA,IAAA,EAAQ,WAAA,EAAY,EAAE,EAAA,EAAI,CAAA,EAAG,IAAI,CAAA,EAAG,EAAA,EAAI,CAAA,EAAG,EAAA,EAAI,CAAA,EAAE,CAAA;AACjD,IAAA,aAAA,CAAA,IAAA,EAAQ,eAAA,sBAAoB,GAAA,EAAqB,CAAA;AAnCnD,IAAA,IAAA,EAAA;AAsCI,IAAA,MAAM,OAAA,GAAU;AAAA,MACd,KAAK,UAAA,EAAW;AAAA,MAChB,WAAW,EAAC;AAAA,MACZ,UAAU,eAAA;AAAgB,KAC5B;AACA,IAAA,IAAA,CAAK,KAAA,GAAQ,IAAI,KAAA,CAAM,OAAO,CAAA;AAC9B,IAAA,IAAA,CAAK,QAAA,GAAW,IAAI,aAAA,CAAc,IAAA,CAAK,MAAM,CAAA;AAE7C,IAAA,IAAA,CAAK,OAAA,GAAA,CAAU,EAAA,GAAA,IAAA,CAAK,OAAA,KAAL,IAAA,GAAA,EAAA,GAAgB,EAAC;AAChC,IAAA,IAAA,CAAK,WAAA,EAAY;AACjB,IAAA,IAAA,CAAK,SAAA,CAAU,KAAK,MAAM,CAAA;AAE1B,IAAA,IAAA,CAAK,KAAA,CAAM,SAAA,CAAU,CAAC,CAAA,KAAM;AAC1B,MAAA,IAAA,CAAK,SAAS,MAAA,CAAO,CAAA,CAAE,KAAK,CAAA,CAAE,QAAA,EAAU,EAAE,SAAS,CAAA;AAAA,IACrD,CAAC,CAAA;AAED,IAAA,IAAA,CAAK,SAAS,MAAA,CAAO,OAAA,CAAQ,KAAK,OAAA,CAAQ,QAAA,EAAU,QAAQ,SAAS,CAAA;AAAA,EACvE;AAAA,EAEA,EAAA,CAAmC,MAAS,EAAA,EAA0C;AACpF,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,EAAA,CAAG,IAAA,EAAM,EAAE,CAAA;AAAA,EACjC;AAAA,EAEA,MAAA,GAAwB;AACtB,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI,CAAE,GAAA;AAAA,EAC1B;AAAA,EAEA,YAAA,GAAyB;AACvB,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI,CAAE,SAAA;AAAA,EAC1B;AAAA,EAEA,KAAK,GAAA,EAAoB;AACvB,IAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAC1B,IAAA,IAAA,CAAK,KAAA,CAAM,KAAA,CAAM,CAAC,CAAA,MAAO,EAAE,GAAG,CAAA,EAAG,GAAA,EAAK,IAAA,EAAM,SAAA,EAAW,EAAC,EAAE,CAAE,CAAA;AAC5D,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,QAAA,EAAU,IAAI,CAAA;AAChC,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,WAAA,EAAa,EAAE,CAAA;AAAA,EACnC;AAAA,EAEA,SAAA,GAAoB;AAClB,IAAA,OAAO,IAAA,CAAK,SAAA,CAAU,IAAA,CAAK,MAAA,EAAQ,CAAA;AAAA,EACrC;AAAA,EAEA,IAAA,GAAO;AAhFT,IAAA,IAAA,EAAA;AAiFI,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI,CAAE,GAAA;AAC7B,IAAA,MAAM,CAAA,GAAI,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,GAAG,CAAA;AAC/B,IAAA,IAAA,CAAK,SAAA,CAAU,EAAE,GAAA,EAAK,CAAA,KAAA,EAAA,CAAQ,OAAE,IAAA,KAAF,IAAA,GAAA,EAAA,GAAU,EAAE,CAAA,CAAA,EAAI,KAAK,CAAA;AAAA,EACrD;AAAA,EAEA,IAAA,GAAO;AAtFT,IAAA,IAAA,EAAA;AAuFI,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI,CAAE,GAAA;AAC7B,IAAA,MAAM,CAAA,GAAI,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,GAAG,CAAA;AAC/B,IAAA,IAAA,CAAK,SAAA,CAAU,EAAE,GAAA,EAAK,CAAA,KAAA,EAAA,CAAQ,OAAE,IAAA,KAAF,IAAA,GAAA,EAAA,GAAU,EAAE,CAAA,CAAA,EAAI,KAAK,CAAA;AAAA,EACrD;AAAA,EAEA,QAAQ,IAAA,EAAe;AACrB,IAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI,CAAE,GAAA;AAC7B,IAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAC1B,IAAA,IAAA,CAAK,KAAA,CAAM,KAAK,IAAI,CAAA;AACpB,IAAA,IAAA,CAAK,iBAAA,CAAkB,SAAA,EAAW,GAAA,EAAK,IAAI,CAAA;AAC3C,IAAA,IAAA,CAAK,YAAA,CAAa,CAAC,IAAA,CAAK,EAAE,CAAC,CAAA;AAAA,EAC7B;AAAA,EAEA,aAAa,GAAA,EAAe;AAC1B,IAAA,IAAA,CAAK,KAAA,CAAM,KAAA,CAAM,CAAC,CAAA,MAAO,EAAE,GAAG,CAAA,EAAG,SAAA,EAAW,CAAC,GAAG,GAAG,CAAA,EAAE,CAAE,CAAA;AACvD,IAAA,IAAA,CAAK,QAAQ,IAAA,CAAK,WAAA,EAAa,CAAC,GAAG,GAAG,CAAC,CAAA;AAAA,EACzC;AAAA,EAEA,YAAY,EAAA,EAAc;AACxB,IAAA,IAAA,CAAK,KAAA,CAAM,MAAM,CAAC,CAAA,MAAO,EAAE,GAAG,CAAA,EAAG,QAAA,EAAU,EAAA,EAAG,CAAE,CAAA;AAChD,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,UAAA,EAAY,EAAE,CAAA;AAAA,EAClC;AAAA,EAEA,OAAA,GAAU;AACR,IAAA,IAAI,IAAA,CAAK,WAAA,EAAa,IAAA,CAAK,WAAA,EAAY;AACvC,IAAA,IAAA,CAAK,SAAS,OAAA,EAAQ;AAAA,EACxB;AAAA,EAEQ,WAAA,GAAc;AAnHxB,IAAA,IAAA,EAAA;AAoHI,IAAA,MAAM,GAAA,GAAqB;AAAA,MACzB,MAAA,EAAQ,MAAM,IAAA,CAAK,KAAA,CAAM,KAAI,CAAE,GAAA;AAAA,MAC/B,MAAA,EAAQ,CAAC,IAAA,EAAM,MAAA,KAAW,KAAK,SAAA,CAAU,IAAA,EAAM,QAAQ,IAAI,CAAA;AAAA,MAC3D,WAAA,EAAa,MAAM,IAAA,CAAK,KAAA,CAAM,KAAI,CAAE,QAAA;AAAA,MACpC,WAAA,EAAa,CAAC,IAAA,KAAS,IAAA,CAAK,YAAY,IAAI,CAAA;AAAA,MAC5C,YAAA,EAAc,MAAM,IAAA,CAAK,KAAA,CAAM,KAAI,CAAE,SAAA;AAAA,MACrC,YAAA,EAAc,CAAC,GAAA,KAAQ,IAAA,CAAK,aAAa,GAAG,CAAA;AAAA,MAC5C,IAAA,EAAM,CAAC,IAAA,EAAM,OAAA,KAAa,KAAK,OAAA,CAAgB,IAAA,CAAK,MAAM,OAAO;AAAA,KACnE;AAEA,IAAA,KAAA,MAAW,CAAA,IAAK,IAAA,CAAK,OAAA,EAAS,CAAA,EAAA,GAAA,CAAA,CAAE,WAAF,IAAA,GAAA,MAAA,GAAA,EAAA,CAAA,IAAA,CAAA,CAAA,EAAW,GAAA,CAAA;AAAA,EAC3C;AAAA,EAEQ,iBAAA,CAAkB,IAAA,EAAc,IAAA,EAAqB,IAAA,EAAqB;AAChF,IAAA,MAAM,QAAA,GAAW,UAAU,IAAI,CAAA;AAC/B,IAAA,MAAM,QAAA,GAAW,UAAU,IAAI,CAAA;AAE/B,IAAA,MAAM,GAAA,GAAe;AAAA,MACnB,IAAA;AAAA,MACA,EAAA,EAAI,MAAM,SAAA,CAAU,QAAQ,CAAA;AAAA,MAC5B,IAAA,EAAM,MAAM,SAAA,CAAU,QAAQ;AAAA,KAChC;AACA,IAAA,IAAA,CAAK,OAAA,CAAQ,KAAK,GAAG,CAAA;AACrB,IAAA,IAAA,CAAK,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,IAAI,CAAA;AAAA,EACrC;AAAA,EAEQ,SAAA,CAAU,OAAA,EAAwB,MAAA,EAAiB,UAAA,GAAa,IAAA,EAAM;AA9IhF,IAAA,IAAA,EAAA;AA+II,IAAA,IAAI,GAAA,GAAM,UAAU,OAAO,CAAA;AAE3B,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,KAAA,MAAW,CAAA,IAAK,KAAK,OAAA,EAAS;AAC5B,QAAA,IAAI,EAAE,cAAA,EAAgB,GAAA,GAAM,CAAA,CAAE,cAAA,CAAe,KAAK,MAAM,CAAA;AAAA,MAC1D;AAAA,IACF;AAEA,IAAA,IAAA,CAAK,KAAA,CAAM,MAAM,CAAC,CAAA,MAAO,EAAE,GAAG,CAAA,EAAG,KAAI,CAAE,CAAA;AACvC,IAAA,IAAA,CAAK,OAAA,CAAQ,IAAA,CAAK,QAAA,EAAU,GAAG,CAAA;AAE/B,IAAA,IAAI,UAAA,EAAY;AACd,MAAA,KAAA,MAAW,KAAK,IAAA,CAAK,OAAA,EAAS,CAAA,EAAA,GAAA,CAAA,CAAE,aAAA,KAAF,2BAAkB,GAAA,EAAK,MAAA,CAAA;AAAA,IACvD;AAAA,EACF;AAAA,EAEQ,UAAU,MAAA,EAA2B;AAC3C,IAAA,MAAA,CAAO,QAAA,GAAW,CAAA;AAElB,IAAA,MAAM,aAAA,GAAgB,CAAC,CAAA,KAAoB;AACzC,MAAA,MAAA,CAAO,iBAAA,CAAkB,EAAE,SAAS,CAAA;AAEpC,MAAA,MAAM,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI;AACzB,MAAA,MAAM,IAAA,GAAO,OAAO,qBAAA,EAAsB;AAC1C,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,OAAA,GAAU,IAAA,CAAK,IAAA;AAC5B,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,OAAA,GAAU,IAAA,CAAK,GAAA;AAE5B,MAAA,MAAM,CAAA,GAAI,aAAA,CAAc,EAAA,EAAI,EAAA,EAAI,EAAE,QAAQ,CAAA;AAC1C,MAAA,MAAM,GAAA,GAAM,QAAQ,CAAA,CAAE,GAAA,CAAI,OAAO,CAAA,CAAE,CAAA,EAAG,EAAE,CAAC,CAAA;AAEzC,MAAA,IAAA,CAAK,QAAA,GAAW,IAAA;AAChB,MAAA,IAAA,CAAK,SAAA,GAAY,EAAE,EAAA,EAAI,EAAA,EAAI,IAAI,CAAA,CAAE,CAAA,EAAG,EAAA,EAAI,CAAA,CAAE,CAAA,EAAE;AAC5C,MAAA,IAAA,CAAK,UAAA,GAAa,MAAA;AAElB,MAAA,IAAA,CAAK,cAAc,KAAA,EAAM;AACzB,MAAA,IAAI,GAAA,IAAO,CAAC,GAAA,CAAI,MAAA,EAAQ;AACtB,QAAA,IAAI,CAAC,CAAA,CAAE,SAAA,CAAU,QAAA,CAAS,GAAA,CAAI,EAAE,CAAA,EAAG,IAAA,CAAK,YAAA,CAAa,CAAC,GAAA,CAAI,EAAE,CAAC,CAAA;AAE7D,QAAA,MAAM,GAAA,GAAM,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI,CAAE,SAAA;AAC7B,QAAA,KAAA,MAAW,MAAM,GAAA,EAAK;AACpB,UAAA,MAAM,CAAA,GAAI,EAAE,GAAA,CAAI,KAAA,CAAM,KAAK,CAAC,IAAA,KAAS,IAAA,CAAK,EAAA,KAAO,EAAE,CAAA;AACnD,UAAA,IAAI,GAAG,IAAA,CAAK,aAAA,CAAc,IAAI,EAAA,EAAI,SAAA,CAAU,CAAC,CAAC,CAAA;AAAA,QAChD;AAAA,MACF,CAAA,MAAO;AACL,QAAA,IAAA,CAAK,YAAA,CAAa,EAAE,CAAA;AACpB,QAAA,IAAA,CAAK,QAAA,GAAW,KAAA;AAAA,MAClB;AAAA,IACF,CAAA;AAEA,IAAA,MAAM,aAAA,GAAgB,CAAC,CAAA,KAAoB;AACzC,MAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AACpB,MAAA,IAAI,IAAA,CAAK,eAAe,MAAA,EAAQ;AAChC,MAAA,MAAM,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI;AACzB,MAAA,IAAI,CAAA,CAAE,SAAA,CAAU,MAAA,KAAW,CAAA,EAAG;AAE9B,MAAA,MAAM,IAAA,GAAO,OAAO,qBAAA,EAAsB;AAC1C,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,OAAA,GAAU,IAAA,CAAK,IAAA;AAC5B,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,OAAA,GAAU,IAAA,CAAK,GAAA;AAE5B,MAAA,MAAM,CAAA,GAAI,aAAA,CAAc,EAAA,EAAI,EAAA,EAAI,EAAE,QAAQ,CAAA;AAC1C,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,EAAA;AAChC,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,EAAA;AAEhC,MAAA,MAAM,MAAM,CAAA,CAAE,GAAA;AACd,MAAA,MAAM,IAAA,GAAO,UAAU,GAAG,CAAA;AAE1B,MAAA,KAAA,MAAW,EAAA,IAAM,EAAE,SAAA,EAAW;AAC5B,QAAA,MAAM,GAAA,GAAM,KAAK,KAAA,CAAM,SAAA,CAAU,CAAC,IAAA,KAAS,IAAA,CAAK,OAAO,EAAE,CAAA;AACzD,QAAA,IAAI,MAAM,CAAA,EAAG;AACb,QAAA,MAAM,IAAA,GAAO,IAAA,CAAK,aAAA,CAAc,GAAA,CAAI,EAAE,CAAA;AACtC,QAAA,IAAI,CAAC,IAAA,EAAM;AAEX,QAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,CAAE,CAAA,GAAI,KAAK,CAAA,GAAI,EAAA;AAC7B,QAAA,IAAA,CAAK,KAAA,CAAM,GAAG,CAAA,CAAE,CAAA,GAAI,KAAK,CAAA,GAAI,EAAA;AAAA,MAC/B;AAEA,MAAA,IAAA,CAAK,SAAA,CAAU,IAAA,EAAM,YAAA,EAAc,IAAI,CAAA;AAAA,IACzC,CAAA;AAEA,IAAA,MAAM,WAAA,GAAc,CAAC,CAAA,KAAoB;AACvC,MAAA,IAAI,CAAC,KAAK,QAAA,EAAU;AACpB,MAAA,IAAA,CAAK,QAAA,GAAW,KAAA;AAChB,MAAA,IAAI,MAAA,CAAO,iBAAA,CAAkB,CAAA,CAAE,SAAS,CAAA,EAAG;AACzC,QAAA,MAAA,CAAO,qBAAA,CAAsB,EAAE,SAAS,CAAA;AAAA,MAC1C;AAEA,MAAA,MAAM,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI;AACzB,MAAA,MAAM,MAAA,GAAS,IAAA,CAAK,mBAAA,CAAoB,CAAC,CAAA;AACzC,MAAA,IAAI,CAAC,MAAA,EAAQ;AAEb,MAAA,MAAM,KAAA,GAAQ,SAAA,CAAU,CAAA,CAAE,GAAG,CAAA;AAC7B,MAAA,MAAM,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,MAAM,CAAA;AAC/B,MAAA,MAAM,CAAA,GAAI,IAAA,CAAK,SAAA,CAAU,KAAK,CAAA;AAC9B,MAAA,IAAI,MAAM,CAAA,EAAG,IAAA,CAAK,iBAAA,CAAkB,MAAA,EAAQ,QAAQ,KAAK,CAAA;AAAA,IAC3D,CAAA;AAEA,IAAA,MAAM,OAAA,GAAU,CAAC,CAAA,KAAkB;AACjC,MAAA,MAAM,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI;AACzB,MAAA,MAAM,IAAA,GAAO,OAAO,qBAAA,EAAsB;AAC1C,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,OAAA,GAAU,IAAA,CAAK,IAAA;AAC5B,MAAA,MAAM,EAAA,GAAK,CAAA,CAAE,OAAA,GAAU,IAAA,CAAK,GAAA;AAE5B,MAAA,MAAM,SAAS,CAAA,CAAE,OAAA;AACjB,MAAA,IAAI,CAAC,MAAA,EAAQ;AAEb,MAAA,CAAA,CAAE,cAAA,EAAe;AAEjB,MAAA,MAAM,KAAK,CAAA,CAAE,QAAA;AACb,MAAA,MAAM,MAAA,GAAS,aAAA,CAAc,EAAA,EAAI,EAAA,EAAI,EAAE,CAAA;AAEvC,MAAA,MAAM,aAAa,IAAA,CAAK,GAAA,CAAI,CAAC,CAAA,CAAE,SAAS,IAAK,CAAA;AAC7C,MAAA,MAAM,WAAW,KAAA,CAAM,EAAA,CAAG,IAAA,GAAO,UAAA,EAAY,KAAK,CAAC,CAAA;AAEnD,MAAA,MAAM,MAAA,GAAmB,EAAE,GAAG,EAAA,EAAI,MAAM,QAAA,EAAS;AACjD,MAAA,MAAM,KAAA,GAAQ,aAAA,CAAc,EAAA,EAAI,EAAA,EAAI,MAAM,CAAA;AAE1C,MAAA,MAAA,CAAO,IAAA,IAAQ,MAAA,CAAO,CAAA,GAAI,KAAA,CAAM,CAAA;AAChC,MAAA,MAAA,CAAO,IAAA,IAAQ,MAAA,CAAO,CAAA,GAAI,KAAA,CAAM,CAAA;AAEhC,MAAA,IAAA,CAAK,YAAY,MAAM,CAAA;AAAA,IACzB,CAAA;AAEA,IAAA,MAAM,SAAA,GAAY,CAAC,CAAA,KAAqB;AACtC,MAAA,IAAI,CAAA,CAAE,QAAQ,GAAA,KAAQ,CAAA,CAAE,WAAW,CAAA,CAAE,OAAA,CAAA,IAAY,CAAC,CAAA,CAAE,QAAA,EAAU;AAC5D,QAAA,CAAA,CAAE,cAAA,EAAe;AACjB,QAAA,IAAA,CAAK,IAAA,EAAK;AAAA,MACZ;AACA,MAAA,IACG,CAAA,CAAE,GAAA,KAAQ,GAAA,KAAQ,CAAA,CAAE,WAAW,CAAA,CAAE,OAAA,CAAA,IAAY,CAAA,CAAE,QAAA,IAC/C,EAAE,GAAA,KAAQ,GAAA,KAAQ,CAAA,CAAE,OAAA,IAAW,EAAE,OAAA,CAAA,EAClC;AACA,QAAA,CAAA,CAAE,cAAA,EAAe;AACjB,QAAA,IAAA,CAAK,IAAA,EAAK;AAAA,MACZ;AACA,MAAA,IAAI,CAAA,CAAE,GAAA,KAAQ,QAAA,IAAY,CAAA,CAAE,QAAQ,WAAA,EAAa;AAC/C,QAAA,MAAM,CAAA,GAAI,IAAA,CAAK,KAAA,CAAM,GAAA,EAAI;AACzB,QAAA,IAAI,CAAA,CAAE,SAAA,CAAU,MAAA,KAAW,CAAA,EAAG;AAC9B,QAAA,MAAM,OAAO,CAAA,CAAE,GAAA;AACf,QAAA,MAAM,IAAA,GAAO,UAAU,IAAI,CAAA;AAC3B,QAAA,IAAA,CAAK,KAAA,GAAQ,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,CAAC,CAAA,KAAM,CAAC,CAAA,CAAE,SAAA,CAAU,QAAA,CAAS,CAAA,CAAE,EAAE,CAAC,CAAA;AACjE,QAAA,IAAA,CAAK,iBAAA,CAAkB,QAAA,EAAU,IAAA,EAAM,IAAI,CAAA;AAC3C,QAAA,IAAA,CAAK,YAAA,CAAa,EAAE,CAAA;AAAA,MACtB;AAAA,IACF,CAAA;AAEA,IAAA,MAAA,CAAO,gBAAA,CAAiB,eAAe,aAAa,CAAA;AACpD,IAAA,MAAA,CAAO,gBAAA,CAAiB,eAAe,aAAa,CAAA;AACpD,IAAA,MAAA,CAAO,gBAAA,CAAiB,aAAa,WAAW,CAAA;AAChD,IAAA,MAAA,CAAO,gBAAA,CAAiB,iBAAiB,WAAW,CAAA;AACpD,IAAA,MAAA,CAAO,iBAAiB,OAAA,EAAS,OAAA,EAAS,EAAE,OAAA,EAAS,OAAO,CAAA;AAC5D,IAAA,MAAA,CAAO,gBAAA,CAAiB,WAAW,SAAS,CAAA;AAE5C,IAAA,IAAA,CAAK,cAAc,MAAM;AACvB,MAAA,MAAA,CAAO,mBAAA,CAAoB,eAAe,aAAa,CAAA;AACvD,MAAA,MAAA,CAAO,mBAAA,CAAoB,eAAe,aAAa,CAAA;AACvD,MAAA,MAAA,CAAO,mBAAA,CAAoB,aAAa,WAAW,CAAA;AACnD,MAAA,MAAA,CAAO,mBAAA,CAAoB,iBAAiB,WAAW,CAAA;AACvD,MAAA,MAAA,CAAO,mBAAA,CAAoB,SAAS,OAAO,CAAA;AAC3C,MAAA,MAAA,CAAO,mBAAA,CAAoB,WAAW,SAAS,CAAA;AAAA,IACjD,CAAA;AAAA,EACF;AAAA,EAEQ,oBAAoB,CAAA,EAAgD;AAC1E,IAAA,IAAI,IAAA,CAAK,aAAA,CAAc,IAAA,KAAS,CAAA,EAAG,OAAO,IAAA;AAC1C,IAAA,MAAM,IAAA,GAAO,SAAA,CAAU,CAAA,CAAE,GAAG,CAAA;AAC5B,IAAA,KAAA,MAAW,CAAC,EAAA,EAAI,QAAQ,KAAK,IAAA,CAAK,aAAA,CAAc,SAAQ,EAAG;AACzD,MAAA,MAAM,GAAA,GAAM,KAAK,KAAA,CAAM,SAAA,CAAU,CAAC,CAAA,KAAM,CAAA,CAAE,OAAO,EAAE,CAAA;AACnD,MAAA,IAAI,OAAO,CAAA,EAAG,IAAA,CAAK,MAAM,GAAG,CAAA,GAAI,UAAU,QAAQ,CAAA;AAAA,IACpD;AACA,IAAA,OAAO,IAAA;AAAA,EACT;AACF;;;ACvTO,SAAS,eAAe,IAAA,EAAsC;AACnE,EAAA,MAAM,IAAA,GAAO,KAAK,GAAA,CAAI,CAAA,EAAG,KAAK,KAAA,CAAM,IAAA,CAAK,IAAI,CAAC,CAAA;AAC9C,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,UAAA;AAAA,IACN,cAAA,CAAe,KAAoB,MAAA,EAAiB;AAClD,MAAA,IAAI,EAAC,MAAA,IAAA,IAAA,GAAA,MAAA,GAAA,MAAA,CAAQ,QAAA,CAAS,MAAA,CAAA,CAAA,EAAS,OAAO,GAAA;AAEtC,MAAA,MAAM,OAAO,IAAA,CAAK,KAAA,CAAM,IAAA,CAAK,SAAA,CAAU,GAAG,CAAC,CAAA;AAC3C,MAAA,KAAA,MAAW,CAAA,IAAK,KAAK,KAAA,EAAO;AAC1B,QAAA,IAAI,CAAA,CAAE,MAAA,IAAU,CAAA,CAAE,MAAA,EAAQ;AAC1B,QAAA,CAAA,CAAE,IAAI,IAAA,CAAK,KAAA,CAAM,CAAA,CAAE,CAAA,GAAI,IAAI,CAAA,GAAI,IAAA;AAC/B,QAAA,CAAA,CAAE,IAAI,IAAA,CAAK,KAAA,CAAM,CAAA,CAAE,CAAA,GAAI,IAAI,CAAA,GAAI,IAAA;AAAA,MACjC;AACA,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,GACF;AACF;AAEO,SAAS,aAAA,GAA8B;AAC5C,EAAA,OAAO;AAAA,IACL,IAAA,EAAM;AAAA,GACR;AACF","file":"index.js","sourcesContent":["export class Emitter<T extends Record<string, any>> {\n  private listeners = new Map<keyof T, Set<(payload: any) => void>>();\n\n  on<K extends keyof T>(type: K, fn: (payload: T[K]) => void): () => void {\n    const set = this.listeners.get(type) ?? new Set();\n    set.add(fn as any);\n    this.listeners.set(type, set);\n    return () => set.delete(fn as any);\n  }\n\n  emit<K extends keyof T>(type: K, payload: T[K]) {\n    const set = this.listeners.get(type);\n    if (!set) return;\n    for (const fn of set) fn(payload);\n  }\n}\n","import { DocumentModel, Viewport } from \"./types\";\n\nexport interface EditorState {\n  doc: DocumentModel;\n  selection: string[];\n  viewport: Viewport;\n}\n\nexport type PatchFn = (s: EditorState) => EditorState;\n\nexport class Store {\n  private state: EditorState;\n  private subs = new Set<(s: EditorState) => void>();\n\n  constructor(initial: EditorState) {\n    this.state = initial;\n  }\n\n  get(): EditorState {\n    return this.state;\n  }\n\n  set(next: EditorState) {\n    this.state = next;\n    for (const fn of this.subs) fn(this.state);\n  }\n\n  patch(fn: PatchFn) {\n    const next = fn(this.state);\n    this.set(next);\n  }\n\n  subscribe(fn: (s: EditorState) => void): () => void {\n    this.subs.add(fn);\n    return () => this.subs.delete(fn);\n  }\n}\n","import { AnyNode, Viewport } from \"./types\";\n\nexport function screenToWorld(x: number, y: number, vp: Viewport) {\n  return { x: x / vp.zoom + vp.panX, y: y / vp.zoom + vp.panY };\n}\n\nexport function worldToScreen(x: number, y: number, vp: Viewport) {\n  return { x: (x - vp.panX) * vp.zoom, y: (y - vp.panY) * vp.zoom };\n}\n\n// MVP: rotation ignored, axis-aligned hit-test\nexport function hitTest(nodes: AnyNode[], wx: number, wy: number): AnyNode | null {\n  const sorted = [...nodes]\n    .filter((n) => !n.hidden)\n    .sort((a, b) => (a.z ?? 0) - (b.z ?? 0));\n\n  for (let i = sorted.length - 1; i >= 0; i--) {\n    const n = sorted[i];\n    if (wx >= n.x && wx <= n.x + n.w && wy >= n.y && wy <= n.y + n.h) return n;\n  }\n  return null;\n}\n\nexport function clamp(v: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, v));\n}\n","import { DocumentModel, RGBA, RectNode, Viewport } from \"./types\";\nimport { worldToScreen } from \"./math\";\n\nfunction compile(gl: WebGL2RenderingContext, type: number, src: string) {\n  const sh = gl.createShader(type);\n  if (!sh) throw new Error(\"createShader failed\");\n  gl.shaderSource(sh, src);\n  gl.compileShader(sh);\n  if (!gl.getShaderParameter(sh, gl.COMPILE_STATUS)) {\n    const log = gl.getShaderInfoLog(sh);\n    gl.deleteShader(sh);\n    throw new Error(`shader compile failed: ${log ?? \"\"}`);\n  }\n  return sh;\n}\n\nfunction link(gl: WebGL2RenderingContext, vs: WebGLShader, fs: WebGLShader) {\n  const p = gl.createProgram();\n  if (!p) throw new Error(\"createProgram failed\");\n  gl.attachShader(p, vs);\n  gl.attachShader(p, fs);\n  gl.linkProgram(p);\n  if (!gl.getProgramParameter(p, gl.LINK_STATUS)) {\n    const log = gl.getProgramInfoLog(p);\n    gl.deleteProgram(p);\n    throw new Error(`program link failed: ${log ?? \"\"}`);\n  }\n  return p;\n}\n\nexport class WebGLRenderer {\n  private gl: WebGL2RenderingContext;\n  private program: WebGLProgram;\n\n  private vao: WebGLVertexArrayObject;\n  private quadVbo: WebGLBuffer;\n  private instanceVbo: WebGLBuffer;\n\n  private uResolution: WebGLUniformLocation;\n  private uBg: WebGLUniformLocation | null;\n\n  private capacity = 0;\n\n  constructor(private canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext(\"webgl2\", { antialias: true, alpha: false });\n    if (!gl) throw new Error(\"WebGL2 not supported\");\n    this.gl = gl;\n\n    const vs = compile(\n      gl,\n      gl.VERTEX_SHADER,\n      `#version 300 es\n      precision highp float;\n\n      // unit quad: (0,0)-(1,1)\n      layout(location=0) in vec2 aPos;\n\n      // instance attributes\n      layout(location=1) in vec4 iRect; // x,y,w,h in screen space (px)\n      layout(location=2) in vec4 iColor;\n\n      uniform vec2 uResolution;\n\n      out vec4 vColor;\n\n      void main() {\n        vec2 pos = iRect.xy + aPos * iRect.zw;\n        // px -> clip\n        vec2 clip = (pos / uResolution) * 2.0 - 1.0;\n        // flip y (canvas y down)\n        clip.y = -clip.y;\n        gl_Position = vec4(clip, 0.0, 1.0);\n        vColor = iColor;\n      }\n    `\n    );\n\n    const fs = compile(\n      gl,\n      gl.FRAGMENT_SHADER,\n      `#version 300 es\n      precision highp float;\n      in vec4 vColor;\n      uniform vec4 uBg;\n      out vec4 outColor;\n      void main() {\n        outColor = vColor + uBg * 0.0;\n      }\n    `\n    );\n\n    this.program = link(gl, vs, fs);\n    gl.deleteShader(vs);\n    gl.deleteShader(fs);\n\n    const uRes = gl.getUniformLocation(this.program, \"uResolution\");\n    const uBg = gl.getUniformLocation(this.program, \"uBg\");\n    if (!uRes) throw new Error(\"uniform location missing: uResolution\");\n    this.uResolution = uRes;\n    this.uBg = uBg;\n\n    const vao = gl.createVertexArray();\n    const quadVbo = gl.createBuffer();\n    const instanceVbo = gl.createBuffer();\n    if (!vao || !quadVbo || !instanceVbo) throw new Error(\"buffer/vao create failed\");\n    this.vao = vao;\n    this.quadVbo = quadVbo;\n    this.instanceVbo = instanceVbo;\n\n    gl.bindVertexArray(this.vao);\n\n    // quad vertices\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.quadVbo);\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array([\n        0, 0,\n        1, 0,\n        0, 1,\n        0, 1,\n        1, 0,\n        1, 1,\n      ]),\n      gl.STATIC_DRAW\n    );\n    gl.enableVertexAttribArray(0);\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n\n    // instance buffer: iRect(4 floats) + iColor(4 floats)\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.instanceVbo);\n    gl.bufferData(gl.ARRAY_BUFFER, 0, gl.DYNAMIC_DRAW);\n\n    const stride = 8 * 4;\n    gl.enableVertexAttribArray(1);\n    gl.vertexAttribPointer(1, 4, gl.FLOAT, false, stride, 0);\n    gl.vertexAttribDivisor(1, 1);\n\n    gl.enableVertexAttribArray(2);\n    gl.vertexAttribPointer(2, 4, gl.FLOAT, false, stride, 4 * 4);\n    gl.vertexAttribDivisor(2, 1);\n\n    gl.bindVertexArray(null);\n  }\n\n  resizeToDisplaySize(dpr = window.devicePixelRatio) {\n    const w = Math.floor(this.canvas.clientWidth * dpr);\n    const h = Math.floor(this.canvas.clientHeight * dpr);\n    if (this.canvas.width !== w || this.canvas.height !== h) {\n      this.canvas.width = w;\n      this.canvas.height = h;\n    }\n  }\n\n  render(doc: DocumentModel, vp: Viewport, selection: string[]) {\n    const gl = this.gl;\n    this.resizeToDisplaySize();\n\n    gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n\n    gl.useProgram(this.program);\n    gl.uniform2f(this.uResolution, this.canvas.width, this.canvas.height);\n\n    const bg = doc.page.background;\n    if (this.uBg) gl.uniform4f(this.uBg, bg[0], bg[1], bg[2], bg[3]);\n    gl.clearColor(bg[0], bg[1], bg[2], bg[3]);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    const rects = doc.nodes.filter(\n      (n): n is RectNode => n.type === \"rect\" && !n.hidden\n    );\n\n    const count = rects.length;\n    const data = new Float32Array(count * 8);\n    const selectionSet = new Set(selection);\n\n    for (let i = 0; i < count; i++) {\n      const n = rects[i];\n      const p = worldToScreen(n.x, n.y, vp);\n      const w = n.w * vp.zoom;\n      const h = n.h * vp.zoom;\n\n      const isSel = selectionSet.has(n.id);\n      const c: RGBA = n.fill;\n      const k = isSel ? 1.15 : 1.0;\n\n      const o = i * 8;\n      data[o + 0] = p.x;\n      data[o + 1] = p.y;\n      data[o + 2] = w;\n      data[o + 3] = h;\n      data[o + 4] = Math.min(1, c[0] * k);\n      data[o + 5] = Math.min(1, c[1] * k);\n      data[o + 6] = Math.min(1, c[2] * k);\n      data[o + 7] = c[3];\n    }\n\n    gl.bindVertexArray(this.vao);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.instanceVbo);\n\n    if (count > this.capacity) {\n      this.capacity = Math.max(count, Math.floor(this.capacity * 1.5) + 64);\n      gl.bufferData(gl.ARRAY_BUFFER, this.capacity * 8 * 4, gl.DYNAMIC_DRAW);\n    }\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, data);\n\n    gl.drawArraysInstanced(gl.TRIANGLES, 0, 6, count);\n\n    gl.bindVertexArray(null);\n  }\n\n  destroy() {\n    const gl = this.gl;\n    gl.deleteBuffer(this.quadVbo);\n    gl.deleteBuffer(this.instanceVbo);\n    gl.deleteVertexArray(this.vao);\n    gl.deleteProgram(this.program);\n  }\n}\n","import { DocumentModel } from \"./types\";\n\nexport interface Command {\n  name: string;\n  do(doc: DocumentModel): DocumentModel;\n  undo(doc: DocumentModel): DocumentModel;\n}\n\nexport class History {\n  private undoStack: Command[] = [];\n  private redoStack: Command[] = [];\n\n  push(cmd: Command) {\n    this.undoStack.push(cmd);\n    this.redoStack = [];\n  }\n\n  canUndo() {\n    return this.undoStack.length > 0;\n  }\n\n  canRedo() {\n    return this.redoStack.length > 0;\n  }\n\n  undo(doc: DocumentModel): { doc: DocumentModel; name?: string } {\n    const cmd = this.undoStack.pop();\n    if (!cmd) return { doc };\n    const next = cmd.undo(doc);\n    this.redoStack.push(cmd);\n    return { doc: next, name: cmd.name };\n  }\n\n  redo(doc: DocumentModel): { doc: DocumentModel; name?: string } {\n    const cmd = this.redoStack.pop();\n    if (!cmd) return { doc };\n    const next = cmd.do(doc);\n    this.undoStack.push(cmd);\n    return { doc: next, name: cmd.name };\n  }\n\n  clear() {\n    this.undoStack = [];\n    this.redoStack = [];\n  }\n}\n","import { Emitter } from \"./events\";\nimport { Store } from \"./store\";\nimport { AnyNode, DocumentModel, EditorEventMap, Handle, Viewport } from \"./types\";\nimport { hitTest, screenToWorld, clamp } from \"./math\";\nimport { WebGLRenderer } from \"./renderer_webgl\";\nimport { EditorPlugin, PluginContext } from \"./plugins\";\nimport { History, Command } from \"./history\";\n\nfunction defaultDoc(): DocumentModel {\n  return {\n    page: { width: 1200, height: 800, background: [0.1, 0.1, 0.12, 1] },\n    nodes: [],\n  };\n}\n\nfunction defaultViewport(): Viewport {\n  return { panX: 0, panY: 0, zoom: 1 };\n}\n\nfunction deepClone<T>(v: T): T {\n  return JSON.parse(JSON.stringify(v));\n}\n\nexport class PageGLEditor {\n  private emitter = new Emitter<EditorEventMap>();\n  private store: Store;\n  private renderer: WebGLRenderer;\n\n  private plugins: EditorPlugin[] = [];\n  private history = new History();\n\n  private unbindInput?: () => void;\n  private dragging = false;\n  private dragHandle: Handle = \"none\";\n  private dragStart = { sx: 0, sy: 0, wx: 0, wy: 0 };\n  private originalNodes = new Map<string, AnyNode>();\n\n  constructor(opts: { canvas: HTMLCanvasElement; plugins?: EditorPlugin[] }) {\n    const initial = {\n      doc: defaultDoc(),\n      selection: [],\n      viewport: defaultViewport(),\n    };\n    this.store = new Store(initial);\n    this.renderer = new WebGLRenderer(opts.canvas);\n\n    this.plugins = opts.plugins ?? [];\n    this.initPlugins();\n    this.bindInput(opts.canvas);\n\n    this.store.subscribe((s) => {\n      this.renderer.render(s.doc, s.viewport, s.selection);\n    });\n\n    this.renderer.render(initial.doc, initial.viewport, initial.selection);\n  }\n\n  on<K extends keyof EditorEventMap>(type: K, fn: (payload: EditorEventMap[K]) => void) {\n    return this.emitter.on(type, fn);\n  }\n\n  getDoc(): DocumentModel {\n    return this.store.get().doc;\n  }\n\n  getSelection(): string[] {\n    return this.store.get().selection;\n  }\n\n  load(doc: DocumentModel) {\n    const safe = deepClone(doc);\n    this.store.patch((s) => ({ ...s, doc: safe, selection: [] }));\n    this.emitter.emit(\"change\", safe);\n    this.emitter.emit(\"selection\", []);\n  }\n\n  serialize(): string {\n    return JSON.stringify(this.getDoc());\n  }\n\n  undo() {\n    const cur = this.store.get().doc;\n    const r = this.history.undo(cur);\n    this.commitDoc(r.doc, `undo:${r.name ?? \"\"}`, false);\n  }\n\n  redo() {\n    const cur = this.store.get().doc;\n    const r = this.history.redo(cur);\n    this.commitDoc(r.doc, `redo:${r.name ?? \"\"}`, false);\n  }\n\n  addNode(node: AnyNode) {\n    const cur = this.store.get().doc;\n    const next = deepClone(cur);\n    next.nodes.push(node);\n    this.commitWithHistory(\"addNode\", cur, next);\n    this.setSelection([node.id]);\n  }\n\n  setSelection(ids: string[]) {\n    this.store.patch((s) => ({ ...s, selection: [...ids] }));\n    this.emitter.emit(\"selection\", [...ids]);\n  }\n\n  setViewport(vp: Viewport) {\n    this.store.patch((s) => ({ ...s, viewport: vp }));\n    this.emitter.emit(\"viewport\", vp);\n  }\n\n  destroy() {\n    if (this.unbindInput) this.unbindInput();\n    this.renderer.destroy();\n  }\n\n  private initPlugins() {\n    const ctx: PluginContext = {\n      getDoc: () => this.store.get().doc,\n      setDoc: (next, reason) => this.commitDoc(next, reason, true),\n      getViewport: () => this.store.get().viewport,\n      setViewport: (next) => this.setViewport(next),\n      getSelection: () => this.store.get().selection,\n      setSelection: (ids) => this.setSelection(ids),\n      emit: (type, payload) => (this.emitter as any).emit(type, payload),\n    };\n\n    for (const p of this.plugins) p.onInit?.(ctx);\n  }\n\n  private commitWithHistory(name: string, prev: DocumentModel, next: DocumentModel) {\n    const prevSnap = deepClone(prev);\n    const nextSnap = deepClone(next);\n\n    const cmd: Command = {\n      name,\n      do: () => deepClone(nextSnap),\n      undo: () => deepClone(prevSnap),\n    };\n    this.history.push(cmd);\n    this.commitDoc(nextSnap, name, true);\n  }\n\n  private commitDoc(nextDoc: DocumentModel, reason?: string, runPlugins = true) {\n    let doc = deepClone(nextDoc);\n\n    if (runPlugins) {\n      for (const p of this.plugins) {\n        if (p.onBeforeCommit) doc = p.onBeforeCommit(doc, reason);\n      }\n    }\n\n    this.store.patch((s) => ({ ...s, doc }));\n    this.emitter.emit(\"change\", doc);\n\n    if (runPlugins) {\n      for (const p of this.plugins) p.onAfterCommit?.(doc, reason);\n    }\n  }\n\n  private bindInput(canvas: HTMLCanvasElement) {\n    canvas.tabIndex = 0;\n\n    const onPointerDown = (e: PointerEvent) => {\n      canvas.setPointerCapture(e.pointerId);\n\n      const s = this.store.get();\n      const rect = canvas.getBoundingClientRect();\n      const sx = e.clientX - rect.left;\n      const sy = e.clientY - rect.top;\n\n      const w = screenToWorld(sx, sy, s.viewport);\n      const hit = hitTest(s.doc.nodes, w.x, w.y);\n\n      this.dragging = true;\n      this.dragStart = { sx, sy, wx: w.x, wy: w.y };\n      this.dragHandle = \"move\";\n\n      this.originalNodes.clear();\n      if (hit && !hit.locked) {\n        if (!s.selection.includes(hit.id)) this.setSelection([hit.id]);\n\n        const sel = this.store.get().selection;\n        for (const id of sel) {\n          const n = s.doc.nodes.find((node) => node.id === id);\n          if (n) this.originalNodes.set(id, deepClone(n));\n        }\n      } else {\n        this.setSelection([]);\n        this.dragging = false;\n      }\n    };\n\n    const onPointerMove = (e: PointerEvent) => {\n      if (!this.dragging) return;\n      if (this.dragHandle !== \"move\") return;\n      const s = this.store.get();\n      if (s.selection.length === 0) return;\n\n      const rect = canvas.getBoundingClientRect();\n      const sx = e.clientX - rect.left;\n      const sy = e.clientY - rect.top;\n\n      const w = screenToWorld(sx, sy, s.viewport);\n      const dx = w.x - this.dragStart.wx;\n      const dy = w.y - this.dragStart.wy;\n\n      const cur = s.doc;\n      const next = deepClone(cur);\n\n      for (const id of s.selection) {\n        const idx = next.nodes.findIndex((node) => node.id === id);\n        if (idx < 0) continue;\n        const base = this.originalNodes.get(id);\n        if (!base) continue;\n\n        next.nodes[idx].x = base.x + dx;\n        next.nodes[idx].y = base.y + dy;\n      }\n\n      this.commitDoc(next, \"drag(move)\", true);\n    };\n\n    const onPointerUp = (e: PointerEvent) => {\n      if (!this.dragging) return;\n      this.dragging = false;\n      if (canvas.hasPointerCapture(e.pointerId)) {\n        canvas.releasePointerCapture(e.pointerId);\n      }\n\n      const s = this.store.get();\n      const before = this.getDocFromOriginals(s);\n      if (!before) return;\n\n      const after = deepClone(s.doc);\n      const b = JSON.stringify(before);\n      const a = JSON.stringify(after);\n      if (b !== a) this.commitWithHistory(\"move\", before, after);\n    };\n\n    const onWheel = (e: WheelEvent) => {\n      const s = this.store.get();\n      const rect = canvas.getBoundingClientRect();\n      const sx = e.clientX - rect.left;\n      const sy = e.clientY - rect.top;\n\n      const isZoom = e.ctrlKey;\n      if (!isZoom) return;\n\n      e.preventDefault();\n\n      const vp = s.viewport;\n      const before = screenToWorld(sx, sy, vp);\n\n      const zoomFactor = Math.exp(-e.deltaY * 0.002);\n      const nextZoom = clamp(vp.zoom * zoomFactor, 0.1, 8);\n\n      const nextVp: Viewport = { ...vp, zoom: nextZoom };\n      const after = screenToWorld(sx, sy, nextVp);\n\n      nextVp.panX += before.x - after.x;\n      nextVp.panY += before.y - after.y;\n\n      this.setViewport(nextVp);\n    };\n\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (e.key === \"z\" && (e.ctrlKey || e.metaKey) && !e.shiftKey) {\n        e.preventDefault();\n        this.undo();\n      }\n      if (\n        (e.key === \"z\" && (e.ctrlKey || e.metaKey) && e.shiftKey) ||\n        (e.key === \"y\" && (e.ctrlKey || e.metaKey))\n      ) {\n        e.preventDefault();\n        this.redo();\n      }\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\n        const s = this.store.get();\n        if (s.selection.length === 0) return;\n        const prev = s.doc;\n        const next = deepClone(prev);\n        next.nodes = next.nodes.filter((n) => !s.selection.includes(n.id));\n        this.commitWithHistory(\"delete\", prev, next);\n        this.setSelection([]);\n      }\n    };\n\n    canvas.addEventListener(\"pointerdown\", onPointerDown);\n    canvas.addEventListener(\"pointermove\", onPointerMove);\n    canvas.addEventListener(\"pointerup\", onPointerUp);\n    canvas.addEventListener(\"pointercancel\", onPointerUp);\n    canvas.addEventListener(\"wheel\", onWheel, { passive: false });\n    canvas.addEventListener(\"keydown\", onKeyDown);\n\n    this.unbindInput = () => {\n      canvas.removeEventListener(\"pointerdown\", onPointerDown);\n      canvas.removeEventListener(\"pointermove\", onPointerMove);\n      canvas.removeEventListener(\"pointerup\", onPointerUp);\n      canvas.removeEventListener(\"pointercancel\", onPointerUp);\n      canvas.removeEventListener(\"wheel\", onWheel);\n      canvas.removeEventListener(\"keydown\", onKeyDown);\n    };\n  }\n\n  private getDocFromOriginals(s: { doc: DocumentModel; selection: string[] }) {\n    if (this.originalNodes.size === 0) return null;\n    const prev = deepClone(s.doc);\n    for (const [id, original] of this.originalNodes.entries()) {\n      const idx = prev.nodes.findIndex((n) => n.id === id);\n      if (idx >= 0) prev.nodes[idx] = deepClone(original);\n    }\n    return prev;\n  }\n}\n","import { EditorPlugin } from \"./plugins\";\nimport { DocumentModel } from \"./types\";\n\nexport function gridSnapPlugin(opts: { size: number }): EditorPlugin {\n  const size = Math.max(1, Math.floor(opts.size));\n  return {\n    name: \"gridSnap\",\n    onBeforeCommit(doc: DocumentModel, reason?: string) {\n      if (!reason?.includes(\"move\")) return doc;\n\n      const next = JSON.parse(JSON.stringify(doc)) as DocumentModel;\n      for (const n of next.nodes) {\n        if (n.locked || n.hidden) continue;\n        n.x = Math.round(n.x / size) * size;\n        n.y = Math.round(n.y / size) * size;\n      }\n      return next;\n    },\n  };\n}\n\nexport function historyPlugin(): EditorPlugin {\n  return {\n    name: \"history\",\n  };\n}\n"]}